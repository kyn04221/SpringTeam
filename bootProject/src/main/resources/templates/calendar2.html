<!DOCTYPE html>
<html lang="ko" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout" xmlns:th="http://www.thymeleaf.org"
      layout:decorate="~{layout/base.html}" >


<link href="https://cdn.jsdelivr.net/npm/@fullcalendar/core/main.css" rel="stylesheet" />
<link href="https://cdn.jsdelivr.net/npm/@fullcalendar/daygrid/main.css" rel="stylesheet" />
<link href="https://cdn.jsdelivr.net/npm/@fullcalendar/timegrid/main.css" rel="stylesheet" />
<script src="https://cdn.jsdelivr.net/npm/@fullcalendar/core/main.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@fullcalendar/daygrid/main.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@fullcalendar/timegrid/main.js"></script>
<script src="https://cdn.jsdelivr.net/npm/moment@2.29.1/moment.min.js"></script>


<head>
    <meta charset="UTF-8">
    <title>산책 일정</title>
    <link rel="stylesheet" th:href="@{/css/calendarcss.css}">
</head>
<body>
<div layout:fragment="content">
    <!-- 캘린더 -------------------------------->
    <div id="calendar-container" class="container-fluid">
        <div id="calendar"></div>
    </div>
    <!-- 우클릭 메뉴 -->
    <div id="contextMenu" class="context-menu">
        <ul>
            <li id="addSchedule">추가</li>
            <li id="deleteSchedule">삭제</li>
        </ul>
    </div>
    <!-- Modal -->
    <div id="scheduleModal" class="custom-modal">
        <div class="custom-modal-content ">
            <div class="custom-modal-header">
                <h5>일정</h5>
                <button type="button" id="closeModal" class="close-button">&times;</button>
            </div>
            <div class="custom-modal-body">
                <p><strong>매칭명:</strong> <span id="modalTitle"></span></p>
                <p><strong>날짜:</strong> <span id="modalDate"></span></p>
                <p><strong>시간:</strong> <span id="modalTime"></span></p>
                <p><strong>장소:</strong> <span id="modalPlace"></span></p>
            </div>
            <div class="custom-modal-footer">
                <button type="button" id="closeModalFooter" class="close-button">닫기</button>
            </div>
        </div>
    </div>

    <!--    &lt;!&ndash; 일정 추가 모달 &ndash;&gt;-->
    <!--    <div id="addscheduleModal" style="display: none;">-->
    <!--        <h3>개인 일정 추가</h3>-->
    <!--        <form id="scheduleForm">-->
    <!--            <label for="scheduleName">일정 이름:</label>-->
    <!--            <input type="text" id="scheduleName" name="scheduleName" required><br>-->

    <!--            <label for="schedulePlace">장소:</label>-->
    <!--            <input type="text" id="schedulePlace" name="schedulePlace" required><br>-->

    <!--            <input type="submit" value="일정 추가">-->
    <!--        </form>-->
    <!--    </div>-->


    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
    <script src='https://cdn.jsdelivr.net/npm/fullcalendar@6.1.15/index.global.min.js'></script>
    <script src="/js/schedule.js"></script>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            var calendarEl = document.getElementById('calendar');
            var calendar = new FullCalendar.Calendar(calendarEl, {
                initialView: 'dayGridMonth',
                headerToolbar: {
                    left: 'prev,next today',
                    center: 'title',
                    right: 'dayGridMonth,timeGridWeek,timeGridDay,listMonth'
                },
                navLinks: true,
                businessHours: true,
                editable: true,
                selectable: true,
                events: async function(fetchInfo, successCallback, failureCallback) {
                    const userId = BigInt(1); // 실제 userId로 교체
                    const schedules = await getUserSchedules(userId);
                    successCallback(schedules);
                },
                // select: function(info) {
                //     // 날짜를 선택하면 해당 날짜 범위를 로그로 출력
                //     console.log("선택된 시작 시간:", info.startStr, "선택된 끝 시간:", info.endStr);
                //
                //     // 일정 추가 모달 표시
                //     openScheduleModal(info.startStr, info.endStr);
                // },
                // select: function(info) {
                //     // 선택된 날짜가 calendar에 표시된 날짜라면
                //     showContextMenu(info.dateStr);
                // },
                eventClick: function(info) { // info는 eventClick 핸들러에서 제공되는 객체
                    const eventDetails = {
                        schedulename: info.event.title,  // 이벤트 제목 (예: 산책 이름)
                        walkDate: info.event.start,  // 추가된 날짜 정보
                        walkTime: info.event.extendedProps.time,  // 시간 정보
                        place: info.event.extendedProps.place  // 장소 정보
                    };
                    displayEventDetails(eventDetails);
                },           // 우클릭 시 일정 추가 모달 호출
                // eventRender: function(info) {
                //     $(info.el).contextmenu(function(event) {
                //         event.preventDefault(); // 기본 우클릭 메뉴 차단
                //         console.log("우클릭된 일정:", info.event.title);
                //     });
                // }
            });
            calendar.render();

            document.getElementById('closeModal').addEventListener('click', function () {
                document.getElementById('scheduleModal').style.display = 'none';
            });

            document.getElementById('closeModalFooter').addEventListener('click', function () {
                document.getElementById('scheduleModal').style.display = 'none';
            });




        });
    </script>

</div>
</body>
</html>
